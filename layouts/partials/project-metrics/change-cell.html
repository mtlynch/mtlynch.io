{{/*
Usage:
  partial "project-metrics/change-cell.html" (dict
    "prev" <number>
    "current" <number>
    "isCurrency" <bool>
  )

Computes change and percent from prev/current and renders:
- neutral: 0 (or $0.00)
- positive/negative: signed amount and signed percent
- positive from prev <= 0: +inf%
*/}}

{{- $change := sub .current .prev -}}
{{- $decimals := cond .isCurrency 2 0 -}}
{{- $percent := 0.0 -}}
{{- if gt .prev 0 -}}
  {{- $percent = div (mul (float $change) 100.0) (float .prev) -}}
{{- end -}}

{{- $sign := cond (gt $change 0) "positive" (cond (lt $change 0) "negative" "neutral") -}}
{{- if eq $sign "neutral" -}}
  {{- if .isCurrency -}}
    $0.00 (0%)
  {{- else -}}
    0 (0%)
  {{- end -}}
{{- else -}}
  {{- $changeAbs := cond (lt $change 0) (mul $change -1) $change -}}
  {{- $amount := printf "%s%s"
    (cond .isCurrency "$" "")
    ($changeAbs | lang.FormatNumber $decimals)
  -}}
  {{- $signedAmount := printf "%s%s"
    (cond (eq $sign "positive") "+" "-")
    $amount
  -}}
  {{- $percentText := cond
    (and (eq $sign "positive") (le .prev 0))
    "+inf%"
    (printf "%+.0f%%" $percent)
  -}}
  <span class="project-metrics-change-{{ $sign }}">{{ $signedAmount }} ({{ $percentText }})</span>
{{- end -}}
